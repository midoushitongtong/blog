---
title: ä½¿ç”¨ husky + lint-staged é˜²æ­¢ğŸ’©çš„æµå…¥
date: 2019-12-21 21:05:05
categories:
  - å¼€å‘æ‚è®°
---

##### å†™åœ¨å‰é¢

###### husky

husky æ˜¯ä¸€ä¸ªç”¨äºç»™ `git` ç›¸å…³æ“ä½œæ·»åŠ é’©å­çš„å·¥å…·ï¼Œé€šè¿‡ husky æˆ‘ä»¬å¯ä»¥éå¸¸ç®€å•çš„ç»™ git ç›¸å…³æ“ä½œæ·»åŠ [é’©å­](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)ï¼Œæœ€ç»ˆæˆ‘ä»¬ä¼šä½¿ç”¨ husky æ¥ç»™ git commit æ“ä½œæŒ‚ä¸Šé’©å­, æ¥é¢„é˜²ä¸€äº›ä¸è‰¯çš„ commitã€‚

###### lint-staged

å…ˆçœ‹çœ‹çœ‹ lint-staged çš„å®˜æ–¹ä»‹ç»ï¼Œä¸ªäººè§‰å¾—è¿˜æ˜¯æŒºæœ‰æ„æ€çš„

> &#x1f6ab;&#x1f4a9; lint-staged
> Run linters against staged git files and don't let &#x1f4a9; slip into your code base!

å¤§æ¦‚æ„æ€æ˜¯ï¼Œåœ¨ä½ å°†æäº¤æš‚å­˜åŒºçš„æ–‡ä»¶åˆ°ä»“åº“ä¹‹å‰ï¼Œå¯ä»¥é€šè¿‡ lint-staged å¯¹æš‚å­˜åŒºçš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥é€šè¿‡æ‰èƒ½æäº¤åˆ°ä»“åº“ï¼Œä»¥é˜²æ­¢&#x1f4a9;çš„æµå…¥ã€‚

<!--more-->

##### ä½¿ç”¨ husky å’Œ lint-staged

1. å®‰è£…ä¾èµ–åº“

```shell
yarn add --dev husky lint-staged
```

2. åœ¨ package.json ä¸­é…ç½® husky

- æˆ‘ä»¬çŸ¥é“ husky ä¼šç»™ git ç›¸å…³æ“ä½œæ·»åŠ é’©å­
- æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ï¼Œé…ç½®é’©å­è§¦å‘ä»¥åè¦åšçš„äº‹æƒ…
- åœ¨è¿™é‡Œæˆ‘ä»¬é…ç½®ï¼Œåœ¨ `git commit` ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ lint-staged å¯¹æš‚å­˜åŒºçš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥

```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  }
}
```

3. åœ¨ package.json ä¸­é…ç½® lint-staged

- è¿™ä¸€æ­¥æˆ‘ä»¬å°†é…ç½® lint-staged çš„æ£€æŸ¥è§„åˆ™ï¼Œlint-staged ä¼šå°†ä¸è§„åˆ™ç›¸åŒ¹é…çš„`æš‚å­˜åŒºçš„æ–‡ä»¶`è¿›è¡Œæ£€æŸ¥
- ç¬¬ä¸€ä¸ªé…ç½®ä¼šæŠŠ src ç›®å½•ä¸‹æ‰€æœ‰ .ts .tsx æ–‡ä»¶è¿›è¡Œ `eslint` ä¿®å¤ï¼Œ`prettier` æ ¼å¼åŒ–ï¼Œä¹‹åå°†æ­¤æ–‡ä»¶å†æ¬¡æäº¤åˆ°æš‚å­˜åŒºä¸­(å› ä¸ºåœ¨è¿›è¡Œæ£€æŸ¥ä¹‹å‰ line-staged ä¼šè¿›è¡Œ `git stash` ç›¸å…³æ“ä½œï¼Œå› æ­¤éœ€è¦å°†æ–‡ä»¶é‡æ–°æäº¤åˆ°æš‚å­˜åŒºä¸­)
- ç¬¬äºŒä¸ªé…ç½®ä¼šæŠŠ src ç›®å½•ä¸‹æ‰€æœ‰ .scss æ–‡ä»¶è¿›è¡Œ `stylelint` ä¿®å¤ï¼Œ`prettier` æ ¼å¼åŒ–ï¼Œä¹‹åå°†æ­¤æ–‡ä»¶å†æ¬¡æäº¤åˆ°æš‚å­˜åŒºä¸­(å› ä¸ºåœ¨è¿›è¡Œæ£€æŸ¥ä¹‹å‰ line-staged ä¼šè¿›è¡Œ `git stash` ç›¸å…³æ“ä½œï¼Œå› æ­¤éœ€è¦å°†æ–‡ä»¶é‡æ–°æäº¤åˆ°æš‚å­˜åŒºä¸­)

```json
{
  "lint-staged": {
    "src/**/*.{ts,tsx}": ["eslint --fix", "prettier --write", "git add"],
    "src/**/*.{scss}": ["stylelint --syntax scss --fix", "prettier --write", "git add"]
  }
}
```

##### husky å’Œ lint-staged çš„å¤§è‡´å·¥ä½œæµç¨‹

1.`git add .` å°†æ‰€æœ‰æ”¹åŠ¨çš„æ–‡ä»¶æäº¤åˆ°æš‚å­˜åŒº

2.`git commit -m "chore: xxx"` æ­¤æ“ä½œä¼šè¢« husky æ‰€æ‹¦æˆª, ä¹‹åè°ƒç”¨ lint-staged å¯¹æ–‡ä»¶è¿›è¡Œæ£€æŸ¥

3.lint-staged ä¼šå…ˆè¿›è¡Œ `git stash` ç›¸å…³æ“ä½œ, ä¹‹åä¼šå°†ä¸è§„åˆ™ç›¸åŒ¹é…çš„`æš‚å­˜åŒºçš„æ–‡ä»¶`è¿›è¡Œæ£€æŸ¥ï¼Œ`åªæœ‰å·²ç»è¢«æäº¤åˆ°æš‚å­˜åŒºçš„æ–‡ä»¶æ‰ä¼šè¢«æ£€æŸ¥ï¼Œä¸ç®¡è§„åˆ™æ€ä¹ˆå†™`

4.ç­‰å¸¦ lint-staged æ‰§è¡Œå®Œæˆåï¼Œåªè¦æœ‰ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰é€šè¿‡æ£€æŸ¥ï¼Œhusky å°†ä¼šé˜»æ­¢æœ¬æ¬¡çš„ `git commt`ï¼Œä¹‹åéœ€è¦ä¿®æ”¹å¯¹åº”çš„æ–‡ä»¶ï¼Œé‡æ–°è¿›è¡Œ `git add` ä¸ `git commit` æ“ä½œ
